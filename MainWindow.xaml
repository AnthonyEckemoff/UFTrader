<Window x:Class="LightSpeedTrader.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:local="clr-namespace:LightSpeedTrader"
        Title="LightSpeed Trader" Height="800" Width="1400"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <local:EmptyStringToVisibilityConverter x:Key="EmptyStringToVisibilityConverter"/>
    </Window.Resources>

    <DockPanel>

        <!-- Non-blocking alert banner (top) -->
        <Border x:Name="AlertBanner" Background="#CCFF7F50" DockPanel.Dock="Top" Visibility="Collapsed" Padding="8">
            <DockPanel>
                <TextBlock x:Name="AlertBannerText" FontWeight="Bold" Foreground="Black" VerticalAlignment="Center"/>
                <Button Content="×" Width="28" Height="28" DockPanel.Dock="Right" Margin="8,0,0,0"
                        Click="CloseBanner_Click" FontWeight="Bold" Background="Transparent" BorderThickness="0"/>
            </DockPanel>
        </Border>

        <!-- Top: login / account controls -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="10" VerticalAlignment="Center" HorizontalAlignment="Left" >
            <TextBlock Text="Host:" VerticalAlignment="Center" Margin="0,0,6,0"/>
            <TextBox x:Name="HostTextBox" Width="120" Text="127.0.0.1" Margin="0,0,8,0"/>
            <TextBlock Text="Port:" VerticalAlignment="Center" Margin="0,0,6,0"/>
            <TextBox x:Name="PortTextBox" Width="70" Text="4002" Margin="0,0,8,0"/>
            <TextBlock Text="ClientId:" VerticalAlignment="Center" Margin="0,0,6,0"/>
            <TextBox x:Name="ClientIdTextBox" Width="50" Text="0" Margin="0,0,12,0"/>

            <Button x:Name="LoginButton" Content="Connect" Click="LoginButton_Click" Margin="0,0,12,0"/>
            <TextBlock x:Name="EnvironmentStatus" FontWeight="Bold" VerticalAlignment="Center"/>

            <StackPanel Width="30"/>

            <!-- Watch/Quick add -->
            <Grid Width="120" Margin="0,0,6,0">
                <TextBox x:Name="StockTextBox"/>
                <TextBlock Text="Symbol" Foreground="Gray" IsHitTestVisible="False"
                           VerticalAlignment="Center" Margin="4,0,0,0"
                           Visibility="{Binding Text, ElementName=StockTextBox, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
            </Grid>
            <Button x:Name="WatchButton" Content="Watch" Click="WatchButton_Click" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Main layout -->
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="360"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Watchlist and alerts -->
            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                <TextBlock Text="Watchlist" FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>
                <ListBox x:Name="WatchlistBox" Height="420" SelectionMode="Single" SelectionChanged="WatchlistBox_SelectionChanged"/>
                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                    <Button Content="Remove" Click="RemoveFromWatchlist_Click" />
                    <Button Content="Request History" Click="RequestHistory_Click" Margin="8,0,0,0"/>
                </StackPanel>

                <!-- Alerts -->
                <TextBlock Text="Alerts" FontWeight="Bold" Margin="0,12,0,4"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                    <ComboBox x:Name="AlertSymbolCombo" Width="100" Margin="0,0,6,0"/>
                    <Grid Width="80" Margin="0,0,6,0">
                        <TextBox x:Name="AlertPriceBox"/>
                        <TextBlock Text="Price" Foreground="Gray" IsHitTestVisible="False"
                                   VerticalAlignment="Center" Margin="4,0,0,0"
                                   Visibility="{Binding Text, ElementName=AlertPriceBox, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                    </Grid>
                    <ComboBox x:Name="AlertDirectionCombo" Width="90" Margin="0,0,6,0">
                        <ComboBoxItem Content="Above" Tag="Above"/>
                        <ComboBoxItem Content="Below" Tag="Below"/>
                    </ComboBox>
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <CheckBox x:Name="AlertOneShotCheck" Content="One-shot" IsChecked="True" VerticalAlignment="Center"/>
                    <Button Content="Add Alert" Click="AddAlertButton_Click" Margin="8,0,0,0"/>
                </StackPanel>
                <TextBlock Text="Active Alerts" FontWeight="Bold" Margin="0,8,0,4"/>
                <ListBox x:Name="AlertsListBox" Height="150">
                    <ListBox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Remove Alert" Click="RemoveAlert_Click"/>
                            <MenuItem Header="Snooze 5 min" Click="SnoozeAlert_Click"/>
                        </ContextMenu>
                    </ListBox.ContextMenu>
                </ListBox>
            </StackPanel>

            <!-- Center: Charts -->
            <TabControl Grid.Column="1" x:Name="ChartTabs">
                <TabItem Header="1m">
                    <Grid>
                        <lvc:CartesianChart x:Name="Chart1Min"/>
                    </Grid>
                </TabItem>
                <TabItem Header="5m">
                    <Grid>
                        <lvc:CartesianChart x:Name="Chart5Min"/>
                    </Grid>
                </TabItem>
                <TabItem Header="15m">
                    <Grid>
                        <lvc:CartesianChart x:Name="Chart15Min"/>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Right: Trade controls -->
            <StackPanel Grid.Column="2" Margin="12,0,0,0">
                <TextBlock Text="Trade Controls" FontSize="16" FontWeight="Bold" Margin="0,0,0,8"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Symbol:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <TextBlock x:Name="SelectedSymbolText" FontWeight="Bold" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Amount $" VerticalAlignment="Center" Margin="0,0,6,0"/>
                    <Grid Width="120">
                        <TextBox x:Name="DollarAmountTextBox" TextChanged="DollarAmountTextBox_TextChanged"/>
                        <TextBlock Text="Amount" Foreground="Gray" IsHitTestVisible="False"
                                   VerticalAlignment="Center" Margin="4,0,0,0"
                                   Visibility="{Binding Text, ElementName=DollarAmountTextBox, Converter={StaticResource EmptyStringToVisibilityConverter}}"/>
                    </Grid>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <Button x:Name="BuyButton" Content="Buy" Width="100" Click="BuyButton_Click" IsEnabled="False" Margin="0,0,6,0"/>
                    <Button x:Name="SellButton" Content="Sell" Width="100" Click="SellButton_Click" IsEnabled="False"/>
                </StackPanel>

                <TextBlock Text="Trade Log" FontSize="16" FontWeight="Bold" Margin="0,14,0,6"/>
                <ListBox x:Name="TradeLogBox" Height="360"/>
            </StackPanel>

        </Grid>
    </DockPanel>
</Window>
